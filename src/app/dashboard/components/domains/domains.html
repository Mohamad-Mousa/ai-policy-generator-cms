<div class="card border-0 shadow-sm h-100">
  <div class="card-body">
    <div class="d-flex align-items-center justify-content-between mb-4">
      <div>
        <p class="text-uppercase text-muted fw-semibold small mb-1">Directory</p>
        <h2 class="h4 mb-0">Domains</h2>
      </div>
      <app-button label="Create Domain" size="sm" variant="primary" icon="add" [functionKey]="functionKey"
        [privilegeAccess]="writePrivilege" (click)="openCreateDomainDialog()"></app-button>
    </div>

    <app-table [columns]="columns" [rows]="tableRows()" [totalCount]="totalCount()" [showActions]="true"
      [enableFilters]="true" [enableSorting]="true" [enablePagination]="true" [loading]="tableLoading()"
      loadingLabel="Loading domains..." [functionKey]="functionKey" [excludedActions]="excludedActions"
      [serverSideSearch]="true" [serverSideFilters]="true" [sortBy]="sortBy" [sortDirection]="sortDirection"
      (pageChange)="onPageChange($event)" (limitChange)="onLimitChange($event)" (searchChange)="onSearchChange($event)"
      (filterChange)="onFilterChange($event)" (sortChange)="onSortChange($event)" (readAction)="onRead($event)"
      (updateAction)="onUpdate($event)" (deleteAction)="onDelete($event)"></app-table>
  </div>
</div>

<app-dialog [open]="isDialogOpen" [title]="dialogTitle" [description]="dialogDescription" (closed)="closeDialog()">
  <form dialog-body [formGroup]="domainForm" class="form-grid">
    <app-form-input [control]="titleControl" formControlName="title" label="Title" type="text"
      placeholder="Enter domain title" [required]="true" [minlength]="2">
    </app-form-input>

    <app-form-input [control]="descriptionControl" formControlName="description" label="Description" type="textarea"
      placeholder="Enter domain description" [required]="true" [minlength]="3">
    </app-form-input>

    <app-form-input [control]="subDomainsControl" formControlName="subDomains" label="Subdomains" type="tags"
      placeholder="Type a subdomain and press Enter" hint="Each subdomain will show as a tag.">
    </app-form-input>

    <app-form-input [control]="iconControl" formControlName="icon" label="Icon" type="text"
      placeholder="e.g., category, folder, domain" hint="Enter a Google Material Icon name">
    </app-form-input>

    <div class="checkbox-field">
      <span class="field-label">Active Status</span>
      <div class="checkbox-wrapper">
        <input type="checkbox" formControlName="isActive" id="isActive" />
        <label for="isActive" class="checkbox-text">Enable or disable this domain</label>
      </div>
    </div>
  </form>

  <div dialog-footer>
    <app-button label="Cancel" variant="text" [disabled]="dialogLoading()" (clicked)="closeDialog()"></app-button>
    <app-button [label]="createButtonLabel" variant="primary-gradient" [loading]="dialogLoading()"
      [disabled]="dialogLoading()" [functionKey]="functionKey"
      [privilegeAccess]="isEditMode ? PrivilegeAccess.U : PrivilegeAccess.W" (clicked)="onSubmit()">
    </app-button>
  </div>
</app-dialog>

<app-dialog [open]="isDeleteDialogOpen" title="Delete domain" description="This action cannot be undone." width="460px"
  (closed)="closeDeleteDialog()">
  <div dialog-body>
    <div class="d-flex align-items-start gap-3">
      <div class="text-danger">
        <span class="material-symbols-rounded" style="font-size: 2rem;">warning</span>
      </div>
      <div>
        <p class="fw-semibold mb-1">Are you sure you want to delete this domain?</p>
        @if (domainToDelete) {
        <p class="text-muted mb-0">
          <strong>{{ domainToDelete.title }}</strong> will be permanently
          removed from the system. This action cannot be undone.
        </p>
        }
      </div>
    </div>
  </div>

  <div dialog-footer>
    <app-button label="Cancel" variant="text" [disabled]="deleteDialogLoading()"
      (clicked)="closeDeleteDialog()"></app-button>
    <app-button [label]="deleteButtonLabel" variant="danger-gradient" [loading]="deleteDialogLoading()"
      [disabled]="deleteDialogLoading()" [functionKey]="functionKey" [privilegeAccess]="deletePrivilege"
      (clicked)="confirmDelete()"></app-button>
  </div>
</app-dialog>

<app-sidebar [open]="isSidebarOpen" title="Domain Details" [fields]="sidebarFields" [data]="sidebarData"
  (closed)="closeSidebar()"></app-sidebar>