<div class="card border-0 shadow-sm h-100">
  <div class="card-body">
    <div class="d-flex flex-wrap align-items-center justify-content-between gap-3 mb-4">
      <div>
        <p class="text-uppercase text-muted fw-semibold small mb-1">Assessment</p>
        <h2 class="h4 mb-0">AI Readiness Assessment</h2>
      </div>
      <div class="d-flex flex-wrap gap-2">
        <app-button label="View Assessments" size="sm" variant="outline" icon="visibility"
          [disabled]="!selectedDomain()" [functionKey]="functionKey" [privilegeAccess]="readPrivilege"
          (click)="viewAssessments()"></app-button>
        <app-button label="Download Template" size="sm" variant="outline" icon="download" [disabled]="!selectedDomain()"
          [loading]="isDownloadingTemplate()" [functionKey]="functionKey" [privilegeAccess]="readPrivilege"
          (click)="downloadTemplate()"></app-button>
        <app-button label="Import File" size="sm" variant="outline" icon="upload" [loading]="isImporting()"
          [functionKey]="functionKey" [privilegeAccess]="writePrivilege" (click)="triggerFileInput()"></app-button>
        <app-button label="New Assessment" size="sm" variant="primary" icon="add" [disabled]="!selectedDomain()"
          [functionKey]="functionKey" [privilegeAccess]="writePrivilege" (click)="startNewAssessment()"></app-button>
      </div>
    </div>

    <div class="alert alert-info mb-4" role="alert">
      <strong>Instructions:</strong> Choose an active domain below. Every new assessment must be linked
      to a selected domain so we can tailor the questionnaire and reporting.
    </div>

    @if (isLoading()) {
    <div class="d-flex flex-column align-items-center justify-content-center py-5 text-muted">
      <app-loader size="lg" variant="inline" label="Loading active domains..."></app-loader>
    </div>
    } @else {
    @if (!domains().length) {
    <div class="alert alert-warning mb-0" role="alert">
      No active domains are available yet. Please create or activate a domain first.
    </div>
    } @else {
    <p class="text-muted small mb-3">
      Select a domain to enable the assessment button. Only one domain can be assessed at a time.
    </p>

    <div class="domains-grid">
      @for (domain of domains(); track domain.id) {
      <div class="domain-card card border-0 shadow-sm h-100" [class.selected]="selectedDomain()?.id === domain.id"
        (click)="selectDomain(domain)">
        <div class="card-body">
          <div class="d-flex align-items-start gap-3 mb-3">
            <span class="material-symbols-rounded domain-icon">{{ domain.icon }}</span>
            <div class="flex-grow-1">
              <h5 class="mb-1">{{ domain.title }}</h5>
              <p class="text-muted small mb-0">{{ domain.description }}</p>
            </div>
          </div>

          <div class="d-flex align-items-center justify-content-between mt-3">
            <div class="flex-grow-1 me-3">
              <div class="progress" style="height: 6px;">
                <div class="progress-bar" [class.bg-success]="domain.completed" [class.bg-primary]="!domain.completed"
                  role="progressbar" [style.width.%]="domain.progress" [attr.aria-valuenow]="domain.progress"
                  aria-valuemin="0" aria-valuemax="100"></div>
              </div>
            </div>
            <span class="badge" [class.bg-primary]="selectedDomain()?.id === domain.id"
              [class.bg-light]="selectedDomain()?.id !== domain.id"
              [class.text-white]="selectedDomain()?.id === domain.id"
              [class.text-muted]="selectedDomain()?.id !== domain.id">
              {{ selectedDomain()?.id === domain.id ? 'Selected' : 'Select' }}
            </span>
          </div>
        </div>
      </div>
      }
    </div>
    }
    }
  </div>
  <input #fileInput type="file" class="visually-hidden" accept=".xlsx,.xls" (change)="onFileSelected($event)" />
</div>